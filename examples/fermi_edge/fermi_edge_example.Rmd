---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.16.1
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---

# Fermi edge fitting example
### In this example, we fit the Fermi edge of the Si-intercalated graphene data set, demonstrating at which kinetic energy to set the chemical potential when it has not been determined from an external reference (such as gold).

```{python}
# %load_ext autoreload
# %autoreload 2
import numpy as np
from igor2 import binarywave
from exubi import band_map
from exubi.plotting import my_settings
from exubi.distributions import *

my_settings()
```

```{python}
dfld = "data_sets"          # Folder containing the data
flnm = "graphene_raw_101"   # Name of the file
extn = ".ibw"               # Extension of the file
tmpr = 80                   # Data temperature [K]

data = binarywave.load(dfld + "/" + flnm + extn)

intn = data["wave"]["wData"]

fnum, anum = data["wave"]["wave_header"]["nDim"][0:2]

fstp, astp = data["wave"]["wave_header"]["sfA"][0:2]
fmin, amin = data["wave"]["wave_header"]["sfB"][0:2]

angl = np.linspace(amin, amin+(anum-1)*astp, anum)
ekin = np.linspace(fmin, fmin+(fnum-1)*fstp, fnum)
```

```{python}
bmap = band_map.band_map(intensities=intn, angles=angl, ekin=ekin, energy_resolution=0.01, temperature=80)
```

```{python}
fdir = fermi_dirac(mu=31.7, temperature=20, background=100, integrated_weight=1000, \
        energy_resolution=0.03, name="test_distribution")

plt.plot(ekin, fdir.convolve(ekin))
plt.show()
```

```{python}
fig = plt.figure(figsize=(6, 5))
ax = fig.gca()

fig = bmap.fit_fermi_edge(mu=32, temperature=80, energy_resolution=0.01,
                          angle_min=-10, angle_max=5, ekin_min=31.9, ekin_max = 32.1, \
                    background=1e5, integrated_weight=1.0e6, ax=ax, title="Fermi edge fit")
```

```{python}

```
